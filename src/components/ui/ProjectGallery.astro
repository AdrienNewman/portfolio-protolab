---
// ProjectGallery Component - Utilise projects.json (unifié avec admin)
import ProjectCard from './ProjectCard.astro';
import ProjectModal from './ProjectModal.astro';
import projectsData from '../../data/projects.json';

// Tri simple : les projets 'featured' en premier
const entries = [...projectsData].sort((a, b) => ((b.featured ? 1 : 0) - (a.featured ? 1 : 0)));
---

<!-- Inject projects data for JavaScript modal -->
<script is:inline define:vars={{ projectsData }}>
    window.projectsDataForModal = projectsData;
</script>

<section class="section" id="projets">
    <div class="projects-container">
        <div class="section-header">
            <span class="section-label">Réalisations</span>
            <h2 class="section-title">Mes <span>Projets</span></h2>
            <p class="section-desc">Infrastructures complètes déployées sur mon homelab Protolab, démontrant mes compétences en environnement réel.</p>
        </div>

        <div class="projects-grid">
            {entries.map(project => (
                <ProjectCard
                    projectId={project.id}
                    title={project.title}
                    description={project.description}
                    stack={project.stack ?? []}
                    featured={project.featured}
                    status={project.status ?? 'Production'}
                    icon={project.icon}
                    iconColor={project.iconColor}
                    glowColor={project.glowColor}
                    stats={project.stats}
                />
            ))}
        </div>
    </div>
</section>

<!-- Single dynamic project modal -->
<ProjectModal />

<style>
    .section { position: relative; z-index: 1; padding: 8rem 2rem; }

    .section-header { text-align: center; margin-bottom: 5rem; }

    .section-label {
        display: inline-block;
        font-family: 'Space Mono', monospace;
        font-size: 0.75rem;
        font-weight: 700;
        letter-spacing: 0.3em;
        text-transform: uppercase;
        color: var(--neon-cyan);
        margin-bottom: 1rem;
        padding: 0.5rem 1rem;
        border: 1px solid var(--neon-cyan);
    }

    .section-title {
        font-family: 'Bebas Neue', sans-serif;
        font-size: clamp(3rem, 8vw, 6rem);
        letter-spacing: 0.02em;
        line-height: 1;
        margin-bottom: 1.5rem;
    }

    .section-title span { color: var(--neon-cyan); }

    .section-desc {
        font-family: 'Bebas Neue', sans-serif;
        font-size: 1.2rem;
        color: var(--gray-light);
        max-width: 600px;
        margin: 0 auto;
        line-height: 1.4;
        letter-spacing: 0.05em;
        text-transform: uppercase;
    }

    .projects-container { max-width: 1400px; margin: 0 auto; }
    .projects-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-bottom: 5rem; }

    @media (max-width: 768px) {
        .section { padding: 5rem 1.5rem; }
        .section-header { margin-bottom: 3rem; }
        .projects-grid { grid-template-columns: 1fr; }
    }
</style>
