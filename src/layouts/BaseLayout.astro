---
import DocModal from '../components/ui/DocModal.astro';
import GameOverlay from '../components/game/GameOverlay.astro';
import ChatWidget from '../components/ui/ChatWidget.astro';
import '../styles/global.css';

interface Props {
  title?: string;
  description?: string;
}

const {
  title = 'Adrien Mercadier | TSSR',
  description = 'Portfolio de Adrien Mercadier - Technicien Supérieur Systèmes et Réseaux'
} = Astro.props;
---

<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, maximum-scale=5.0">
    <meta name="description" content={description}>
    <title>{title}</title>

    <!-- Fonts: Brutalist choices -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    <!-- Preload critical fonts to prevent FOUT -->
    <link rel="preload" href="https://fonts.gstatic.com/s/bebasneue/v14/JTUSjIg69CK48gW7PXoo9Wlhyw.woff2" as="font" type="font/woff2" crossorigin>
    <link rel="preload" href="https://fonts.gstatic.com/s/spacemono/v13/i7dPIFZifjKcF5UAWdDRYEF8RQ.woff2" as="font" type="font/woff2" crossorigin>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Space+Mono:wght@400;700&family=Bebas+Neue&family=JetBrains+Mono:wght@400;700&display=block" rel="stylesheet">

    <!-- Font loading detection script -->
    <script>
        document.documentElement.classList.add('fonts-loading');
        if ('fonts' in document) {
            Promise.all([
                document.fonts.load('1em "Bebas Neue"'),
                document.fonts.load('1em "Space Mono"')
            ]).then(function() {
                document.documentElement.classList.remove('fonts-loading');
                document.documentElement.classList.add('fonts-loaded');
            }).catch(function() {
                document.documentElement.classList.remove('fonts-loading');
            });
        } else {
            document.documentElement.classList.remove('fonts-loading');
        }
    </script>
</head>
<body>
    <!-- Skip to content for accessibility -->
    <a href="#main-content" class="skip-link">Aller au contenu principal</a>

    <!-- Custom Cursor -->
    <div class="custom-cursor" id="cursor"></div>

    <!-- Three.js Background -->
    <canvas id="three-canvas"></canvas>

    <!-- Main Content -->
    <main id="main-content">
        <slot />
    </main>

    <!-- Documentation Modal -->
    <DocModal />

    <!-- NetDefender Game Overlay (Easter Egg) -->
    <GameOverlay />

    <!-- Chat Widget - Protolab Assistant -->
    <ChatWidget />

    <!-- Three.js via CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"
            integrity="sha512-dLxUelApnYxpLt6K2iomGngnHO83iUvZytA3YjDUCjT0HDOHKXnVYdf3hU4JjM8uEhxf9nD1/ey98U3t2vZ0qQ=="
            crossorigin="anonymous"
            referrerpolicy="no-referrer"></script>

    <!-- Marked.js for chat markdown parsing -->
    <script is:inline src="https://cdn.jsdelivr.net/npm/marked/marked.min.js" defer></script>

    <!-- Custom Scripts -->
    <script is:inline src="/scripts/custom-cursor.js"></script>
    <script is:inline src="/scripts/three-background.js"></script>
    <script is:inline src="/scripts/scroll-animations.js"></script>
    <script is:inline src="/scripts/typing-effect.js"></script>
    <script is:inline src="/scripts/modal-system.js?v=4.17"></script>
    <script is:inline src="/scripts/doc-counter.js"></script>

    <!-- LiveLab - Real-time infrastructure monitoring -->
    <script is:inline src="/scripts/lab-status.js"></script>

    <!-- NetDefender Easter Egg - Floating Packet -->
    <script is:inline src="/scripts/floating-packet.js"></script>

    <!-- Chat Widget -->
    <script is:inline src="/scripts/chat-widget.js"></script>
</body>
</html>
